<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cash Offer Lead Form</title>

<style>
  * {
    box-sizing: border-box;
  }
  
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  .cash-offer-form {
    width: 100%;
    height: 100%;
    padding: clamp(16px, 4vw, 20px);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    max-width: 600px;
    margin: 0 auto;
    overflow-y: auto;
    overflow-x: hidden;
  }
  
  .form-group {
    margin-bottom: 24px;
    position: relative;
  }
  
  .form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #333;
    font-size: clamp(13px, 2.5vw, 14px);
  }
  
  .form-input {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #dadce0;
    border-radius: 8px;
    font-size: clamp(14px, 3vw, 16px);
    transition: all 0.2s;
    background-color: #fff;
  }
  
  .form-input:focus {
    outline: none;
  }
  
  .form-input:hover:not(.error):not(.success) {
    border-color: #303030;
  }
  
  .form-input.error {
    border-color: #dc3545;
    background-color: #fff5f5;
  }
  
  .form-input.error:focus {
    border-color: #dc3545;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
  }
  
  .form-input.success {
    border-color: #28a745;
    background-color: #f8fff9;
  }
  
  .form-input.success:focus {
    border-color: #28a745;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
  }
  
  .form-input:not(.error):not(.success):focus {
    border-color: #ff6b35;
    box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
  }
  
  .field-error {
    font-size: clamp(12px, 2vw, 13px);
    color: #dc3545;
    margin-top: 4px;
    display: none;
    animation: slideIn 0.3s ease;
  }
  
  .field-error.show {
    display: block;
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  /* Modern Google Places Autocomplete styling */
  .pac-container {
    border-radius: 8px;
    border: 1px solid #dadce0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    margin-top: 2px;
  }
  
  .pac-item {
    padding: 12px 16px;
    font-size: clamp(13px, 2.5vw, 14px);
    cursor: pointer;
    border: none;
  }
  
  .pac-item:hover {
    background-color: #f5f5f5;
  }
  
  .pac-item-selected {
    background-color: #e8f0fe;
  }
  
  .pac-icon {
    display: none;
  }
  
  .pac-item-query {
    font-weight: 600;
    color: #202124;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }
  
  .submit-btn {
    width: 100%;
    padding: clamp(16px, 4vw, 20px) clamp(24px, 5vw, 32px);
    background-color: #ff6b35;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: clamp(16px, 4vw, 20px);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 0.3px;
    box-shadow: 0 4px 6px rgba(255, 107, 53, 0.3);
  }
  
  .submit-btn:hover {
    background-color: #e55a2b;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(255, 107, 53, 0.4);
  }
  
  .submit-btn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .submit-btn:focus {
    outline: none;
  }
  
  .success-message {
    display: none;
    text-align: center;
    padding: clamp(30px, 6vw, 50px) clamp(20px, 4vw, 30px);
    animation: fadeIn 0.6s ease;
    background: linear-gradient(135deg, #fff5f2 0%, #fff 100%);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    position: relative;
    width: 100%;
    height: auto;
    min-height: auto;
  }
  
  .success-message::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 107, 53, 0.05) 0%, transparent 70%);
    animation: pulse 3s ease-in-out infinite;
  }
  
  .success-icon {
    width: clamp(70px, 15vw, 100px);
    height: clamp(70px, 15vw, 100px);
    background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto clamp(20px, 4vw, 30px);
    animation: scaleIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    z-index: 1;
    box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
  }
  
  .success-icon svg {
    width: 50%;
    height: 50%;
    stroke: white;
    stroke-width: 3;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }
  
  .success-title {
    font-size: clamp(28px, 5vw, 36px);
    font-weight: 800;
    color: #1a202c;
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
  }
  
  .success-text {
    font-size: clamp(17px, 3vw, 20px);
    color: #4a5568;
    line-height: 1.6;
    max-width: 450px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }
  
  @keyframes fadeIn {
    from { 
      opacity: 0; 
      transform: translateY(30px) scale(0.95);
    }
    to { 
      opacity: 1; 
      transform: translateY(0) scale(1);
    }
  }
  
  @keyframes scaleIn {
    from { 
      transform: scale(0) rotate(-180deg);
      opacity: 0;
    }
    to { 
      transform: scale(1) rotate(0);
      opacity: 1;
    }
  }
  
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.1); opacity: 0.3; }
  }
  
  .error-message {
    display: none;
    padding: 20px;
    background-color: #fff;
    border: 1px solid #ffebee;
    border-radius: 12px;
    color: #c62828;
    margin-top: 20px;
    box-shadow: 0 4px 12px rgba(255, 0, 0, 0.1);
    position: relative;
    animation: fadeIn 0.4s ease;
  }
  
  .error-message::before {
    content: '‚ö†Ô∏è';
    font-size: 24px;
    margin-right: 10px;
  }
  
  @media (max-width: 600px) {
    .form-row {
      grid-template-columns: 1fr;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .submit-btn {
      font-size: 18px;
    }
  }
  
  /* Ensure form works in small containers */
  @media (max-width: 400px) {
    .cash-offer-form {
      padding: 12px;
    }
    
    .form-input {
      padding: 10px 12px;
    }
  }
</style>
</head>
<body>

<div class="cash-offer-form">
  <form id="cashOfferForm">
    
    <!-- Address Field -->
    <div class="form-group">
      <label class="form-label" for="property_address">Property Address*</label>
      <input 
        type="text" 
        id="property_address" 
        name="property_address" 
        class="form-input" 
        placeholder="Enter your property address" 
        required
      />
      <span class="field-error" id="addressError">Please enter a valid address</span>
    </div>
    
    <!-- Hidden fields for address components -->
    <input type="hidden" name="street_number" value="" />
    <input type="hidden" name="route" value="" />
    <input type="hidden" name="city" value="" />
    <input type="hidden" name="state" value="" />
    <input type="hidden" name="postal_code" value="" />
    <input type="hidden" name="country" value="USA" />
    
    <!-- Name Field -->
    <div class="form-group">
      <label class="form-label" for="full_name">Name*</label>
      <input 
        type="text" 
        id="full_name" 
        name="full_name" 
        class="form-input" 
        placeholder="John Smith"
        required
      />
      <span class="field-error" id="nameError">Please enter your full name</span>
    </div>
    
    <!-- Hidden fields for parsed name -->
    <input type="hidden" name="first_name" value="" />
    <input type="hidden" name="last_name" value="" />
    
    <!-- Contact Fields -->
    <div class="form-group">
      <label class="form-label" for="email">Email*</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        class="form-input" 
        placeholder="john@example.com"
        required
      />
      <span class="field-error" id="emailError">Please enter a valid email address</span>
    </div>
    
    <div class="form-group">
      <label class="form-label" for="phone">Phone*</label>
      <input 
        type="tel" 
        id="phone" 
        name="phone" 
        class="form-input" 
        placeholder="(555) 123-4567"
        required
      />
      <span class="field-error" id="phoneError">Please enter a valid phone number</span>
    </div>
    
    <!-- Submit Button -->
    <button type="submit" class="submit-btn">Get My Cash Offer</button>
  </form>
  
  <!-- Success/Error Messages -->
  <div class="success-message" id="successMessage">
    <div class="success-icon">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h2 class="success-title">You're All Set! üéâ</h2>
    <p class="success-text">Your cash offer is being prepared. We'll contact you within 24 hours with a competitive offer for your property.</p>
  </div>
  <div class="error-message" id="errorMessage">
    Sorry, there was an error. Please try again or call us directly.
  </div>
</div>

<script>
// Optimize loading - defer non-critical operations
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeForm);
} else {
  initializeForm();
}

function initializeForm() {
  // Validation functions
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }
  
  function validatePhone(phone) {
    const cleaned = phone.replace(/\D/g, '');
    return cleaned.length === 10;
  }
  
  function showError(fieldId, errorId) {
    document.getElementById(fieldId).classList.add('error');
    document.getElementById(errorId).classList.add('show');
  }
  
  function hideError(fieldId, errorId) {
    document.getElementById(fieldId).classList.remove('error');
    document.getElementById(errorId).classList.remove('show');
  }
  
  // Real-time validation
  const emailInput = document.getElementById('email');
  if (emailInput) {
    emailInput.addEventListener('blur', function() {
      if (this.value) {
        if (!validateEmail(this.value)) {
          showError('email', 'emailError');
        } else {
          hideError('email', 'emailError');
          this.classList.add('success');
        }
      }
    });
    
    emailInput.addEventListener('input', function() {
      if (this.classList.contains('error')) {
        if (validateEmail(this.value)) {
          hideError('email', 'emailError');
        }
      }
      this.classList.remove('success');
    });
  }
  
  // Phone number formatting and validation
  const phoneInput = document.getElementById('phone');
  if (phoneInput) {
    phoneInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 0) {
        if (value.length <= 3) {
          value = `(${value}`;
        } else if (value.length <= 6) {
          value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
        } else {
          value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
        }
      }
      e.target.value = value;
      
      if (this.classList.contains('error')) {
        if (validatePhone(value)) {
          hideError('phone', 'phoneError');
        }
      }
      this.classList.remove('success');
    });
    
    phoneInput.addEventListener('blur', function() {
      if (this.value) {
        if (!validatePhone(this.value)) {
          showError('phone', 'phoneError');
        } else {
          hideError('phone', 'phoneError');
          this.classList.add('success');
        }
      }
    });
  }
  
  // Name validation
  const nameInput = document.getElementById('full_name');
  if (nameInput) {
    nameInput.addEventListener('blur', function() {
      if (this.value.trim().length < 2) {
        showError('full_name', 'nameError');
      } else {
        hideError('full_name', 'nameError');
        this.classList.add('success');
      }
    });
    
    nameInput.addEventListener('input', function() {
      if (this.classList.contains('error')) {
        if (this.value.trim().length >= 2) {
          hideError('full_name', 'nameError');
        }
      }
      this.classList.remove('success');
    });
  }
  
  // Address validation
  const addressInput = document.getElementById('property_address');
  if (addressInput) {
    addressInput.addEventListener('blur', function() {
      if (this.value.trim().length < 5) {
        showError('property_address', 'addressError');
      } else {
        hideError('property_address', 'addressError');
        this.classList.add('success');
      }
    });
    
    addressInput.addEventListener('input', function() {
      if (this.classList.contains('error')) {
        if (this.value.trim().length >= 5) {
          hideError('property_address', 'addressError');
        }
      }
      this.classList.remove('success');
    });
    
    // Add success state when place is selected from autocomplete
    addressInput.addEventListener('place_changed', function() {
      this.classList.add('success');
      hideError('property_address', 'addressError');
    });
  }

  // Form submission handling
  const form = document.getElementById('cashOfferForm');
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validate all fields
      let isValid = true;
      
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const name = document.getElementById('full_name').value;
      const address = document.getElementById('property_address').value;
      
      // Validate email
      if (!validateEmail(email)) {
        showError('email', 'emailError');
        isValid = false;
      }
      
      // Validate phone
      if (!validatePhone(phone)) {
        showError('phone', 'phoneError');
        isValid = false;
      }
      
      // Validate name
      if (name.trim().length < 2) {
        showError('full_name', 'nameError');
        isValid = false;
      }
      
      // Validate address
      if (address.trim().length < 5) {
        showError('property_address', 'addressError');
        isValid = false;
      }
      
      if (!isValid) {
        return;
      }
      
      const submitBtn = document.querySelector('.submit-btn');
      const successMsg = document.getElementById('successMessage');
      const errorMsg = document.getElementById('errorMessage');
      const formElement = document.getElementById('cashOfferForm');
      
      // Disable submit button
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      
      // Hide any previous messages
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';
  
  // Gather form data
  // Parse full name into first and last
  const fullName = document.getElementById('full_name').value.trim();
  const nameParts = fullName.split(' ');
  const firstName = nameParts[0] || '';
  const lastName = nameParts.slice(1).join(' ') || '';
  
  // Update hidden fields
  document.querySelector('[name="first_name"]').value = firstName;
  document.querySelector('[name="last_name"]').value = lastName;
  
  const formData = new FormData(this);
  const data = Object.fromEntries(formData);
  
  try {
    // Submit to Formspree
    const response = await fetch('https://formspree.io/f/xblyrjpg', {
      method: 'POST',
      body: formData,
      headers: {
        'Accept': 'application/json'
      }
    });
    
    // Push to dataLayer for GTM
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      'event': 'formSubmission',
      'formID': 'cashOfferForm',
      'email': data.email,
      'firstName': data.first_name,
      'lastName': data.last_name,
      'phone': data.phone,
      'postalCode': data.postal_code || '',
      'country': 'USA',
      'propertyAddress': data.property_address,
      'city': data.city || '',
      'state': data.state || ''
    });
    
    // Hide the form
    formElement.style.display = 'none';
    
    // Show success message
    successMsg.style.display = 'block';
    
  } catch (error) {
    // Show error message
    errorMsg.style.display = 'block';
    console.error('Submission error:', error);
  } finally {
    // Re-enable submit button
    submitBtn.disabled = false;
    submitBtn.textContent = 'Get My Cash Offer';
  }
    });
  }
}

// Google Maps Autocomplete with proper error handling
let autocomplete;

function initMap() {
  try {
    const input = document.getElementById('property_address');
    
    // Create autocomplete with minimal options
    autocomplete = new google.maps.places.Autocomplete(input);
    
    // Restrict to US addresses
    autocomplete.setComponentRestrictions({
      country: ['us'],
    });
    
    // Specify fields to return
    autocomplete.setFields(['address_components', 'formatted_address']);
    
    // Listen for place selection
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      const addressInput = document.getElementById('property_address');
      
      if (!place.address_components) {
        console.log('No address details available');
        return;
      }
      
      // Mark address field as valid
      if (addressInput) {
        addressInput.classList.add('success');
        addressInput.classList.remove('error');
        document.getElementById('addressError').classList.remove('show');
      }
      
      // Parse address components
      place.address_components.forEach(component => {
        const types = component.types;
        
        if (types.includes('street_number')) {
          document.querySelector('[name="street_number"]').value = component.long_name;
        }
        if (types.includes('route')) {
          document.querySelector('[name="route"]').value = component.long_name;
        }
        if (types.includes('locality')) {
          document.querySelector('[name="city"]').value = component.long_name;
        }
        if (types.includes('administrative_area_level_1')) {
          document.querySelector('[name="state"]').value = component.short_name;
        }
        if (types.includes('postal_code')) {
          document.querySelector('[name="postal_code"]').value = component.long_name;
        }
      });
    });
    
    console.log('Google Places Autocomplete initialized successfully');
    
  } catch (error) {
    console.error('Error initializing autocomplete:', error);
  }
}

// Make initMap globally accessible
window.initMap = initMap;
</script>

<!-- Configuration and Google Maps API -->
<script src="config.js"></script>

</body>
</html>